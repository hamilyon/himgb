-- GuessEnglishEnc.hs
module GuessEnglishEnc

where
import Data.Map as Map

-- credit for frequency goes to Charles SDudu (iwin_1 at hotmail.com)
frequency :: (Ord a) => [a] -> Map.Map a Int
frequency xs = foldl f Map.empty xs
    where f m x = let
                m' = Map.insertWith (+) x 1 m
                Just v = Map.lookup x m'
                in seq v m'

normalize :: Map.Map Char Int -> Map.Map Char Double
normalize frequencies = Map.map f frequencies
    where f count = (fromIntegral count) / n
          n = norm frequencies

norm :: Map.Map Char Int -> Double
norm frequencies = (Map.fold (\a b -> (fromIntegral a**2)+b) 0 frequencies) ** 0.5

dropSpace = Map.delete ' '

freq = normalize . dropSpace . frequency

correlation :: Map.Map Char Double -> Map.Map Char Double -> Double
correlation a b = (Map.fold (+) 0 intersectProduct) 
    where intersectProduct = Map.intersectionWith (\a b -> a * b) a b

-- typicalEnglish :: Map.Map Char Double
-- typicalEnglish = Map.fromList [('\n',3.5987338165738035e-2),
--     (' ',0.9327924684054336),('!',2.1042243868835806e-4),('"',4.996576453218102e-3),('#',2.2190002625317758e-4),('$',6.325426035722763e-4),('%',1.9384370109472985e-4),('&',1.6961323845788862e-4),('\'',5.002952890754113e-3),('(',6.005328871415019e-3),(')',5.992575996342997e-3),('*',5.85356965805796e-4),('+',1.259984057115744e-3),(',',1.696642499581767e-2),('-',1.2082073843233359e-2),('.',2.4322283337359786e-2),('/',5.134307503995936e-3),('0',6.398117423633287e-3),('1',7.001328414539913e-3),('2',5.4799104184477246e-3),('3',2.558226739447553e-3),('4',2.4791589140010185e-3),('5',1.6221657091611602e-3),('6',1.2370288819861049e-3),('7',1.103123693729877e-3),('8',1.9856226487137787e-3),('9',2.5441985768683293e-3),(':',9.284093052431797e-3),(';',3.940638397254705e-4),('<',1.087820243643451e-3),('=',4.2505332615048325e-3),('>',5.7821535576546386e-3),('?',4.884351152584311e-4),('@',5.10115002880868e-5),('A',2.7278399779054417e-3),('B',2.731665840427048e-3),('C',5.442927080738862e-3),('D',2.5760807645483835e-3),('E',2.38606292597526e-3),('F',2.7048848027758027e-3),('G',1.5163168460633801e-3),('H',3.207348080613458e-3),('I',5.315398330018645e-3),('J',1.2867650947669897e-3),('K',2.3465290132519928e-4),('L',2.632193414865279e-3),('M',3.405017644229794e-3),('N',6.736068613041862e-3),('O',2.893627353841724e-3),('P',3.538922832486022e-3),('Q',2.1552358871716672e-4),('R',2.2687364753126603e-3),('S',6.741169763070671e-3),('T',6.331802473258774e-3),('U',1.319922569954246e-3),('V',6.580483537163197e-4),('W',3.030083117112356e-3),('X',2.3592818883240145e-4),('Y',3.2264773932214904e-4),('Z',6.503966286731067e-5),('[',2.670452040081344e-3),('\\',8.17459292116591e-4),(']',2.65642387750212e-3),('^',1.1222530063379096e-4),('_',1.0929213936722597e-3),('`',8.48066192289443e-4),('a',0.10727590981833934),('b',1.6810839919939004e-2),('c',5.3446024139335746e-2),('d',4.389539599789869e-2),('e',0.1713093708424675),('f',3.112466690077616e-2),('g',2.7347265304443334e-2),('h',5.520081974924593e-2),('i',9.55011802643417e-2),('j',6.988575539467891e-4),('k',1.1139636375410955e-2),('l',6.361389143425865e-2),('m',4.837037986067111e-2),('n',0.10073751076891381),('o',0.10910084624114565),('p',3.533439096205052e-2),('q',2.1131513994339956e-3),('r',8.636757113775977e-2),('s',9.255399083519748e-2),('t',0.13535519015191672),('u',4.09609594438265e-2),('v',1.2121607755956627e-2),('w',2.19795801866294e-2),('x',6.991126114482296e-3),('y',2.2397874488991713e-2),('z',1.3428777450838851e-3),('{',4.0044027726148136e-4),('|',7.179868665548217e-4),('}',3.787603896390445e-4),('~',8.799483799694973e-5),('\201',1.27528750720217e-6),('\225',3.82586252160651e-6),('\228',1.27528750720217e-6),('\233',1.020230005761736e-5),('\237',1.27528750720217e-6),('\239',1.27528750720217e-6),('\243',1.27528750720217e-6),('\246',5.10115002880868e-6),('\250',2.55057501440434e-6),('\252',2.55057501440434e-6),('\259',1.27528750720217e-6),('\262',1.27528750720217e-6),('\269',1.27528750720217e-6),('\283',1.27528750720217e-6),('\322',2.55057501440434e-6),('\353',5.10115002880868e-6),('\537',1.27528750720217e-6),('\539',3.82586252160651e-6),('\955',2.55057501440434e-6),('\8211',3.82586252160651e-6),('\8212',8.544426298254539e-5),('\8216',6.37643753601085e-6),('\8217',2.933161266564991e-5),('\8220',6.312673160650742e-4),('\8221',6.312673160650742e-4),('\8226',3.82586252160651e-6),('\8800',1.27528750720217e-6)]

typicalSpam = Map.fromList [('\t',8.580503187410604e-3),('\n',0.11644877066588909),
    ('\f',9.61221417559067e-6),('\r',1.313669270664058e-4),('\ESC',2.5632571134908452e-5),('!',7.7314242685667615e-3),('"',0.14057542824662167),('#',1.0525374522271782e-2),('$',1.445036197730464e-3),('%',1.4706687688653723e-3),('&',4.219762023084304e-3),('\'',2.925317180771427e-3),('(',3.1303777498506943e-3),(')',3.204071391863556e-3),('*',4.60425059010793e-3),('+',7.561608484797993e-4),(',',2.162107375229528e-2),('-',9.04765679634431e-2),('.',8.634011179654726e-2),('/',0.17116469782474303),('0',0.10406183066494458),('1',5.1120959057183044e-2),('2',3.951260840446138e-2),('3',6.605193174326722e-2),('4',1.6734864879703354e-2),('5',1.635037631267973e-2),('6',3.236112105782192e-2),('7',8.586911330194331e-3),('8',1.4607361475505953e-2),('9',2.8682847099962556e-2),(':',0.1250196616391241),(';',3.754210449846529e-2),('<',8.947689768918167e-2),('=',0.13187957848910398),('>',8.954097911701894e-2),('?',2.8932764668527914e-3),('@',3.8256612418850863e-3),('A',2.2864253452338338e-2),('B',1.623502974257264e-2),('C',2.7285871973110044e-2),('D',6.385714283984067e-2),('E',2.240607124330185e-2),('F',1.726353665936084e-2),('G',3.8512938130199946e-3),('H',1.254073542775396e-2),('I',8.715074185868874e-3),('J',8.554870616275695e-4),('K',1.2303634144756057e-3),('L',1.2880366995291496e-2),('M',1.7619188583857696e-2),('N',1.4642606260816452e-2),('O',1.4530463762101228e-2),('P',1.261442906976682e-2),('Q',1.1054046301929269e-3),('R',1.3521181273664208e-2),('S',1.7558311227412287e-2),('T',3.0457902651054965e-2),('U',4.972718800172239e-3),('V',6.106960072891938e-3),('W',5.985205360001123e-3),('X',2.1050749044543566e-3),('Y',5.834614004583536e-3),('Z',1.6725252665527764e-3),('[',3.16241846376933e-3),('\\',9.61221417559067e-6),(']',3.156010320985603e-3),('^',2.5952978274094805e-4),('_',8.952175468866777e-3),('`',5.1265142269816904e-5),('a',0.2453517668319518),('b',5.9820012886092594e-2),('c',0.18931896633104195),('d',0.11954069955903743),('e',0.35828246710957473),('f',0.11406814562173447),('g',6.840372014489507e-2),('h',0.13436273381779823),('i',0.24849496086736997),('j',3.578947744711592e-3),('k',1.917316320891152e-2),('l',0.19581682311374124),('m',0.175720887343973),('n',0.2261177262665949),('o',0.3026886243893502),('p',0.14585253382902094),('q',5.780144790921856e-3),('r',0.23044963078839442),('s',0.28765512141872634),('t',0.33303438454168993),('u',7.60486344858815e-2),('v',3.536654002338994e-2),('w',5.659351299448599e-2),('x',7.040306069341792e-2),('y',5.919201489328734e-2),('z',8.872073684070187e-3),('{',5.4981865084378625e-3),('|',9.003440611136594e-4),('}',5.501390579829726e-3),('~',9.61221417559067e-6),('\145',6.408142783727113e-6),('\146',6.408142783727113e-6),('\163',3.2040713918635565e-6),('\169',1.6020356959317782e-5),('\183',9.61221417559067e-5),('\237',3.2040713918635565e-6),('\243',3.2040713918635565e-6),('\1042',9.61221417559067e-6),('\1050',6.408142783727113e-6),('\1053',3.2040713918635565e-6),('\1065',3.2040713918635565e-6),('\1072',4.1652928094226234e-5),('\1073',6.408142783727113e-6),('\1074',1.2816285567454226e-5),('\1076',1.6020356959317782e-5),('\1077',1.6020356959317782e-5),('\1078',3.2040713918635565e-6),('\1079',3.2040713918635565e-6),('\1080',2.2428499743044895e-5),('\1081',6.408142783727113e-6),('\1082',3.2040713918635565e-6),('\1083',1.6020356959317782e-5),('\1084',2.2428499743044895e-5),('\1085',2.2428499743044895e-5),('\1086',3.2040713918635565e-5),('\1087',1.6020356959317782e-5),('\1088',1.2816285567454226e-5),('\1089',9.61221417559067e-6),('\1090',2.2428499743044895e-5),('\1091',6.408142783727113e-6),('\1096',3.2040713918635565e-6),('\1100',6.408142783727113e-6),('\1103',9.61221417559067e-6),('\1110',1.6020356959317782e-5),('\8364',8.01017847965889e-5)]

isGarbage :: String -> Bool
isGarbage input = (correlation typicalSpam (freq input)) < 0.5
